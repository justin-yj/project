<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <!-- build:css styles/optimized.min.css -->
    <!-- endbuild -->
</head>

<body>
    <input type="text" name="search" id="name" />
    <button id="btnSearch">搜索</button>
    <!-- build:js lib/lib.min.js -->
    <script type="text/javascript" src="lib/jquery-3.1.1.min.js"></script>
    <!-- endbuild -->
    <script type="text/javascript">
    var names = [
        '小五台',
        '西灵山',
        '东灵山',
        '东猴顶',
        '大海坨',
        '小海坨',
        '雾灵山',
        '白草畔',
        '云雾山',
        '百花山',
        '韭菜山',
        '涿鹿十八盘岭',
        '黄花梁',
        '大黑林',
        '白古寺山',
        '犁铧山',
        '马鞍山',
        '卯镇山',
        '黄草梁',
        '梧桐树沟顶',
        '铁镢岭',
        '金华山',
        '怀柔南猴顶',
        '灰金坨',
        '平顶山',
        '老龙窝',
        '天桥山',
        '断口岭',
        '广坨山',
        '鬼门关西大尖',
        '金树塔',
        '西得山',
        '营四路山',
        '千松背',
        '东大尖',
        '水水峪尖',
        '黑坨山',
        '凤凰坨',
        '清水尖',
        '髽鬏山',
        '芦子水',
        '头道沟大尖',
        '杨树底北山',
        '瓜曲草',
        '延庆南猴顶',
        '抓角山',
        '笔架山',
        '南横岭',
        '白铁山',
        '黄楼洼',
        '傲玉尖',
        '棋盘山',
        '云蒙山',
        '二道岗梁',
        '大黑尖',
        '大塌梁',
        '富贵山',
        '南山安',
        '鸭山',
        '梁家山',
        '大寨顶',
        '木城粱',
        '山神庙山',
        '柳木坑梁头',
        '水峪东大尖',
        '横岭西沟',
        '黑山',
        '庙沟山',
        '灰树塔尖',
        '冠帽山',
        '猴石梁头',
        '上寺岭',
        '三棱坨',
        '大北坨子',
        '红土鞍',
        '大头庆',
        '妙峰山',
        '大洼尖',
        '石人子山',
        '燕羽山',
        '阳台山',
        '桃树崖尖',
        '月牙鞍',
        '暴雨2顶',
        '二石门子',
        '暴雨顶',
        '佛爷顶',
        '茶楼顶',
        '沟北岭东山',
        '窝头尖',
        '清水顶',
        '青松顶',
        '东指壶',
        '大石门子',
        '照山',
        '大凹尖',
        '黄花顶',
        '洼卧山',
        '青杠尖',
        '辽坡',
        '东山尖',
        '十八盘',
        '南天门',
        '张家山',
        '应梦寺山',
        '牛角胡',
        '老虎坑',
        '连三顶',
        '贾胡山',
        '太安山',
        '半块豆腐山',
        '延庆十八盘岭',
        '大寒岭',
        '槟榔山',
        '化木仑',
        '萝卜地北尖',
        '大敞洼',
        '鹰翅梁',
        '九眼楼',
        '道虎窝南山',
        '八股山',
        '锅顶山',
        '三座',
        '平安梁',
        '荞麦山',
        '孙家山',
        '黄嵯沟山',
        '青峰岭',
        '谭子港尖',
        '南大坨',
        '腊千山',
        '阳坡高尖',
        '铁坨山',
        '南大梁',
        '北京结点',
        '大西岔',
        '晾马场',
        '高家山',
        '歪坨山',
        '马蹄湾顶',
        '二垛子',
        '鳞龙山',
        '蚂蚁山',
        '磨盘山',
        '吹风坨',
        '马腰梁',
        '黄土梁',
        '四座楼',
        '青龙背',
        '白云坨',
        '珠峰',
        '鸡冠山',
        '大尖山',
        '滦平平顶山',
        '庆家坨',
        '牛角边',
        '桦木坨',
        '黄砬顶',
        '大龙门',
        '梨花顶',
        '桃山',
        '五座楼山',
        '棺材山',
        '行字鞍',
        '三角城',
        '莲花山',
        '大白石尖',
        '蚂蚁梁',
        '西刁窝梁'
    ];
    var obj = {
        'newmap': 1,
        'reqflag': 'pcmap',
        'biz': 1,
        'from': 'webmap',
        'da_par': 'baidu',
        'pcevaname': 'pc4.1',
        'qt': 's',
        'da_src': 'searchBox.button',
        'wd': '村卫生室',
        'c': 131,
        'src': 0,
        'wd2': '',
        'sug': 0,
        'l': 8,
        'b': '(12777527.633342644,4707161.600960928;13458859.244758459,4984480.459326456)',
        'biz_forward': '{"scaler":1,"styles":"pl"}',
        'sug_forward': '',
        'tn': 'B_NORMAL_MAP',
        'nn': 0,
        'u_loc': '12955455,4850990',
        'ie': 'utf-8',
        't': '1491985669818'
    };

    //湖南省
    $('#btnSearch').click(function() {
        for (var i = 0; i < names.length; i++) {
            var name = names[i];
            obj['wd'] = name;
            getResult(newObject);
        }
    });
    var results = {};
    function getResult(newObj) {
        var params = $.param(newObj);
        var url = 'http://map.baidu.com/?' + params;
        $.ajax({
            url: url,
            method: "GET",
            dataType: "jsonp",
            success: function(suc) {
                if (suc.content && suc.content.length > 0) {
                    for (var i = 0; i < suc.content.length; i++) {
                        var con = suc.content[i];
                        if (results[suc.current_city.code]) {
                            results[suc.current_city.code].push({
                                city: suc.current_city.name,
                                addr: con.addr,
                                area: con.area_name,
                                x: con.x / 100,
                                y: con.y / 100,
                                name: con.name
                            });
                        } else {
                            results[suc.current_city.code] = [];
                            results[suc.current_city.code].push({
                                city: suc.current_city.name,
                                addr: con.addr,
                                area: con.area_name,
                                x: con.x / 100,
                                y: con.y / 100,
                                name: con.name
                            });

                        }
                    }
                    newObj['pn'] = (newObj['pn'] ? newObj['pn'] : 0) + 1;
                    newObj['nn'] = newObj['nn'] + 10;
                    getResult(newObj);
                }
            },
            error: function(err) {
                console.log(err);
            }
        });
    }

    setTimeout(function() {
        getWGS_84();
    }, 60000);

    var locs = [],
        bdllPoints = [];


    function lastCalc() {
        for (var i = 0; i < locs.length; i++) {
            var lnglat = GPS.bd09ll_wgs84(bdllPoints[i].x, bdllPoints[i].y);
            locs[i].x = lnglat[0];
            locs[i].y = lnglat[1];
        }
        for (var j = 0; j < locs.length; j++) {
            var l = locs[j];
            console.log(l.city + "    " + l.addr + "    " + l.area + "    " + l.x + "    " + l.y + "    " + l.name);
        }
    }

    function getBDLL(j, pageCount) {
        if (j > pageCount) {

            lastCalc();

            return;
        }
        var coords = '';
        for (var a = (j - 1) * 70; a < j * 70; a++) {
            if (locs[a]) {
                coords += '' + locs[a].x + ',' + locs[a].y + ';';
            }
        }
        coords = coords.substr(0, coords.length - 1);
        var params = {
            coords: coords,
            ak: 'tBGLkiFX2eUitQHQ65xIV00RD4FdoFGB',
            from: 6,
            to: 5,
            output: 'json'
        };
        var res = $.param(params);
        $.ajax({
            url: 'http://api.map.baidu.com/geoconv/v1/?' + res,
            method: 'GET',
            dataType: 'jsonp',
            success: function(suc) {
                bdllPoints = bdllPoints.concat(suc.result);
                j = j + 1;
                getBDLL(j, pageCount);
            },
            error: function(err) {
                console.log(err);
            }
        })
    }

    function getWGS_84() {
        for (var i in results) {
            var r = results[i];
            locs = locs.concat(r);
        }
        var coords = [];
        var pagecount = Math.ceil(locs.length / 70);
        getBDLL(1, pagecount);
    }

    /**
     * conversion methods
     * originally from http://www.oschina.net/code/snippet_260395_39205
     * @type {Object}
     */
    var GPS = {
        PI: Math.PI,
        x_pi: Math.PI * 3000.0 / 180.0,
        delta: function(lat, lon) {
            // Krasovsky 1940
            //
            // a = 6378245.0, 1/f = 298.3
            // b = a * (1 - f)
            // ee = (a^2 - b^2) / a^2;
            var a = 6378245.0; //  a: 卫星椭球坐标投影到平面地图坐标系的投影因子。
            var ee = 0.00669342162296594323; //  ee: 椭球的偏心率。
            var dLat = this.transformLat(lon - 105.0, lat - 35.0);
            var dLon = this.transformLon(lon - 105.0, lat - 35.0);
            var radLat = lat / 180.0 * this.PI;
            var magic = Math.sin(radLat);
            magic = 1 - ee * magic * magic;
            var sqrtMagic = Math.sqrt(magic);
            dLat = (dLat * 180.0) / ((a * (1 - ee)) / (magic * sqrtMagic) * this.PI);
            dLon = (dLon * 180.0) / (a / sqrtMagic * Math.cos(radLat) * this.PI);
            return {
                'lat': dLat,
                'lon': dLon
            };
        },

        //WGS-84 to GCJ-02
        wgs84_gcj02: function(wgsLon, wgsLat) {
            if (this.outOfChina(wgsLat, wgsLon))
                return [wgsLon, wgsLat];

            var d = this.delta(wgsLat, wgsLon);
            return [wgsLon + d.lon, wgsLat + d.lat];
        },
        //GCJ-02 to WGS-84
        gcj02_wgs84: function(gcjLon, gcjLat) {
            if (this.outOfChina(gcjLat, gcjLon))
                return [gcjLon, gcjLat];

            var d = this.delta(gcjLat, gcjLon);
            return [gcjLon - d.lon, gcjLat - d.lat];
        },
        //GCJ-02 to WGS-84 exactly
        gcj02_wgs84_precise: function(gcjLon, gcjLat) {
            var initDelta = 0.01;
            var threshold = 0.000000001;
            var dLat = initDelta,
                dLon = initDelta;
            var mLat = gcjLat - dLat,
                mLon = gcjLon - dLon;
            var pLat = gcjLat + dLat,
                pLon = gcjLon + dLon;
            var wgsLat, wgsLon, i = 0;
            while (1) {
                wgsLat = (mLat + pLat) / 2;
                wgsLon = (mLon + pLon) / 2;
                var tmp = this.gcj_encrypt(wgsLat, wgsLon)
                dLat = tmp.lat - gcjLat;
                dLon = tmp.lon - gcjLon;
                if ((Math.abs(dLat) < threshold) && (Math.abs(dLon) < threshold))
                    break;

                if (dLat > 0) pLat = wgsLat;
                else mLat = wgsLat;
                if (dLon > 0) pLon = wgsLon;
                else mLon = wgsLon;

                if (++i > 10000) break;
            }
            return [wgsLon, wgsLat];
        },
        //GCJ-02 to BD-09
        gcj02_bd09ll: function(gcjLon, gcjLat) {
            var x = gcjLon,
                y = gcjLat;
            var z = Math.sqrt(x * x + y * y) + 0.00002 * Math.sin(y * this.x_pi);
            var theta = Math.atan2(y, x) + 0.000003 * Math.cos(x * this.x_pi);
            var bdLon = z * Math.cos(theta) + 0.0065;
            var bdLat = z * Math.sin(theta) + 0.006;
            return [bdLon, bdLat];
        },
        //BD-09 to GCJ-02
        bd09ll_gcj02: function(bdLon, bdLat) {
            var x = bdLon - 0.0065,
                y = bdLat - 0.006;
            var z = Math.sqrt(x * x + y * y) - 0.00002 * Math.sin(y * this.x_pi);
            var theta = Math.atan2(y, x) - 0.000003 * Math.cos(x * this.x_pi);
            var gcjLon = z * Math.cos(theta);
            var gcjLat = z * Math.sin(theta);
            return [gcjLon, gcjLat];
        },

        wgs84_bd09ll: function(wgsLon, wgsLat) {
            var c = this.wgs84_gcj02(wgsLon, wgsLat);
            return this.gcj02_bd09ll(c[0], c[1]);
        },

        bd09ll_wgs84: function(wgsLon, wgsLat) {
            var c = this.bd09ll_gcj02(wgsLon, wgsLat);
            return this.gcj02_wgs84(c[0], c[1]);
        },

        outOfChina: function(lat, lon) {
            if (lon < 72.004 || lon > 137.8347)
                return true;
            if (lat < 0.8293 || lat > 55.8271)
                return true;
            return false;
        },
        transformLat: function(x, y) {
            var ret = -100.0 + 2.0 * x + 3.0 * y + 0.2 * y * y + 0.1 * x * y + 0.2 * Math.sqrt(Math.abs(x));
            ret += (20.0 * Math.sin(6.0 * x * this.PI) + 20.0 * Math.sin(2.0 * x * this.PI)) * 2.0 / 3.0;
            ret += (20.0 * Math.sin(y * this.PI) + 40.0 * Math.sin(y / 3.0 * this.PI)) * 2.0 / 3.0;
            ret += (160.0 * Math.sin(y / 12.0 * this.PI) + 320 * Math.sin(y * this.PI / 30.0)) * 2.0 / 3.0;
            return ret;
        },
        transformLon: function(x, y) {
            var ret = 300.0 + x + 2.0 * y + 0.1 * x * x + 0.1 * x * y + 0.1 * Math.sqrt(Math.abs(x));
            ret += (20.0 * Math.sin(6.0 * x * this.PI) + 20.0 * Math.sin(2.0 * x * this.PI)) * 2.0 / 3.0;
            ret += (20.0 * Math.sin(x * this.PI) + 40.0 * Math.sin(x / 3.0 * this.PI)) * 2.0 / 3.0;
            ret += (150.0 * Math.sin(x / 12.0 * this.PI) + 300.0 * Math.sin(x / 30.0 * this.PI)) * 2.0 / 3.0;
            return ret;
        }
    };

    var ProjectionTransform = {
        crs: {
            'bd09ll': '+proj=longlat +datum=BD09',
            'gcj02': '+proj=longlat +datum=GCJ02',
            'wgs84': '+proj=longlat +datum=WGS84 +no_defs'
        },

        /**
         * transform geojson's coordinates
         * @param  {Object | Array} source a coordinate [x,y] or a geoJSON object to convert
         * @param  {String | CRS Object} fromCRS    crs converted from
         * @param  {String | CRS Object} toCRS      crs converted to
         * @return {Object} result geoJSON object
         */
        transform: function(source, fromCRS, toCRS) {
            if (!source) {
                return null;
            }
            if (!fromCRS || !toCRS) {
                throw new Error('must provide a valid fromCRS and toCRS.');
            }
            if (this._isCoord(source)) {
                return this._transformCoordinate(source, fromCRS, toCRS);
            } else if (this._isArray(source)) {
                var result = [];
                for (var i = 0; i < source.length; i++) {
                    result.push(this.transform(source[i], fromCRS, toCRS));
                }
                return result;
            }
            return this._transformGeoJSON(source, fromCRS, toCRS);
        },

        _transformGeoJSON: function(geoJSON, fromCRS, toCRS) {
            if (geoJSON['type'] === 'Feature') {
                var geometry = this.transform(geoJSON['geometry'], fromCRS, toCRS);
                var result = this._extend({}, geoJSON);
                result['geometry'] = geometry;
                return result;
            } else if (geoJSON['type'] === 'FeatureCollection') {
                var features = geoJSON['features'];
                var result = this._extend({}, geoJSON);
                var convertedFea = [];
                for (var i = 0; i < features.length; i++) {
                    convertedFea.push(this.transform(features[i], fromCRS, toCRS));
                }
                result['features'] = convertedFea;
                return result;
            } else if (geoJSON['type'] === 'GeometryCollection') {
                var geometries = geoJSON['geometries'];
                var result = this._extend({}, geoJSON);
                var convertedGeo = [];
                for (var i = 0; i < geometries.length; i++) {
                    convertedGeo.push(this.transform(geometries[i], fromCRS, toCRS));
                }
                result['geometries'] = convertedGeo;
                return result;
            }
            var result = this._extend({}, geoJSON);
            var coordinates = this._transformCoordinate(geoJSON['coordinates'], fromCRS, toCRS);
            result['coordinates'] = coordinates;
            return result;
        },

        _transformCoordinate: function(coordinates, fromCRS, toCRS) {
            var f = fromCRS,
                t = toCRS;
            if (fromCRS['type'] === 'proj4') {
                f = this._toCRS(fromCRS['properties']['proj']);
            }
            if (toCRS['type'] === 'proj4') {
                t = this._toCRS(toCRS['properties']['proj']);
            }
            f = f.toLowerCase();
            t = t.toLowerCase();
            if (f === 'epsg:4326') {
                f = 'wgs84';
            }
            if (t === 'epsg:4326') {
                t = 'wgs84';
            }
            if (f === t) {
                return coordinates;
            }
            var m = f + '_' + t;
            return this._eachCoordinate(coordinates, function(c) {
                return GPS[m](parseFloat(c[0]), parseFloat(c[1]));
            }, this);
        },

        _extend: function(src, dst) {
            for (var p in dst) {
                if (dst.hasOwnProperty(p)) {
                    src[p] = dst[p];
                }
            }
            return src;
        },

        _toCRS: function(proj) {
            for (var p in this.crs) {
                if (proj === this.crs[p]) {
                    return p;
                }
            }
            return null;
        },

        _eachCoordinate: function(coordinates, fn, context) {
            if (this._isCoord(coordinates)) {
                return fn.call(context, coordinates);
            }
            var result = [];
            for (var i = 0, len = coordinates.length; i < len; i++) {
                var p = coordinates[i];
                if (p == null) {
                    continue;
                }
                if (this._isCoord(p)) {
                    var pp = fn.call(context, p);
                    result.push(pp);
                } else if (this._isArray(p)) {
                    result.push(this._eachCoordinate(p, fn, context));
                }
            }
            return result;
        },

        _isCoord: function(coordinate) {
            if (this._isArray(coordinate) && this._isNumber(coordinate[0]) && this._isNumber(coordinate[1])) {
                return true;
            }
            return false;
        },

        _isNumber: function(val) {
            return (typeof val === 'number') && !isNaN(val);
        },

        _isArray: function(obj) {
            if (!obj) {
                return false;
            }
            return typeof obj == 'array' || (obj.constructor !== null && obj.constructor == Array);
        },

        _isString: function(_str) {
            if (_str == null) {
                return false;
            }
            return typeof _str == 'string' || (_str.constructor !== null && _str.constructor == String);
        },
    };
    </script>
</body>

</html>
